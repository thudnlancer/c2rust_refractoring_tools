use std::f64::consts::PI;

const GSL_SUCCESS: i32 = 0;
const GSL_EDOM: i32 = 1;
const GSL_EUNDRFLW: i32 = 15;
const GSL_EOVRFLW: i32 = 16;

#[derive(Debug, Clone, Copy)]
pub struct GslSfResult {
    pub val: f64,
    pub err: f64,
}

#[derive(Debug, Clone, Copy)]
pub struct ChebSeries {
    pub c: &'static [f64],
    pub order: i32,
    pub a: f64,
    pub b: f64,
    pub order_sp: i32,
}

type GslModeT = u32;

fn gsl_mode_prec(mt: GslModeT) -> u32 {
    mt & 7
}

fn cheb_eval_mode_e(
    cs: &ChebSeries,
    x: f64,
    mode: GslModeT,
    result: &mut GslSfResult,
) -> i32 {
    let mut d = 0.0;
    let mut dd = 0.0;
    let y = (2.0 * x - cs.a - cs.b) / (cs.b - cs.a);
    let y2 = 2.0 * y;
    
    let eval_order = if gsl_mode_prec(mode) == 0 {
        cs.order
    } else {
        cs.order_sp
    };

    for j in (1..=eval_order).rev() {
        let temp = d;
        d = y2 * d - dd + cs.c[j as usize];
        dd = temp;
    }

    result.val = y * d - dd + 0.5 * cs.c[0];
    result.err = 2.2204460492503131e-16 * result.val.abs() + cs.c[eval_order as usize].abs();
    GSL_SUCCESS
}

static AIF_DATA: [f64; 8] = [
    0.10527461226531408809,
    0.01183613628152997844,
    0.00012328104173225664,
    0.00000062261225638140,
    0.00000000185298887844,
    0.00000000000363328873,
    0.00000000000000504622,
    0.00000000000000000522,
];

static AIF_CS: ChebSeries = ChebSeries {
    c: &AIF_DATA,
    order: 7,
    a: -1.0,
    b: 1.0,
    order_sp: 7,
};

static AIG_DATA: [f64; 9] = [
    0.021233878150918666852,
    0.086315930335214406752,
    0.001797594720383231358,
    0.000014265499875550693,
    0.000000059437995283683,
    0.000000000152403366479,
    0.000000000000264587660,
    0.000000000000000331562,
    0.000000000000000314,
];

static AIG_CS: ChebSeries = ChebSeries {
    c: &AIG_DATA,
    order: 8,
    a: -1.0,
    b: 1.0,
    order_sp: 8,
};

static AIP1_DATA: [f64; 25] = [
    0.0358865097808301538,
    0.0114668575627764899,
    -0.0007592073583861400,
    0.0000869517610893841,
    -0.0000128237294298592,
    0.0000022062695681038,
    -0.0000004222295185921,
    0.0000000874686415726,
    -0.0000000192773588418,
    0.0000000044668460054,
    -0.0000000010790108052,
    0.0000000002700029447,
    -0.0000000000696480108,
    0.0000000000184489907,
    -0.0000000000050027817,
    0.0000000000013852243,
    -0.0000000000003908218,
    0.0000000000001121536,
    -0.0000000000000326862,
    0.0000000000000096619,
    -0.0000000000000028935,
    0.0000000000000008770,
    -0.0000000000000002688,
    0.0000000000000000832,
    -0.0000000000000000260,
];

static AIP1_CS: ChebSeries = ChebSeries {
    c: &AIP1_DATA,
    order: 24,
    a: -1.0,
    b: 1.0,
    order_sp: 14,
};

static AIP2_DATA: [f64; 15] = [
    0.0065457691989713757,
    0.0023833724120774592,
    -0.0000430700770220586,
    0.0000015629125858629,
    -0.0000000815417186163,
    0.0000000054103738057,
    -0.0000000004284130883,
    0.0000000000389497963,
    -0.0000000000039623161,
    0.0000000000004428184,
    -0.0000000000000536297,
    0.0000000000000069650,
    -0.0000000000000009620,
    0.0000000000000001403,
    -0.0000000000000000215,
];

static AIP2_CS: ChebSeries = ChebSeries {
    c: &AIP2_DATA,
    order: 14,
    a: -1.0,
    b: 1.0,
    order_sp: 9,
};

static BIF_DATA: [f64; 8] = [
    0.1153536790828570243,
    0.0205007894049192875,
    0.0002135290278902876,
    0.0000010783960614677,
    0.0000000032094708833,
    0.0000000000062930407,
    0.0000000000000087403,
    0.0000000000000000090,
];

static BIF_CS: ChebSeries = ChebSeries {
    c: &BIF_DATA,
    order: 7,
    a: -1.0,
    b: 1.0,
    order_sp: 7,
};

static BIG_DATA: [f64; 9] = [
    -0.097196440416443537390,
    0.149503576843167066571,
    0.003113525387121326042,
    0.000024708570579821297,
    0.000000102949627731379,
    0.000000000263970373987,
    0.000000000000458279271,
    0.000000000000000574283,
    0.000000000000000000544,
];

static BIG_CS: ChebSeries = ChebSeries {
    c: &BIG_DATA,
    order: 8,
    a: -1.0,
    b: 1.0,
    order_sp: 8,
};

static BIP1_DATA: [f64; 24] = [
    -0.1729187351079553719,
    -0.0149358492984694364,
    -0.0005471104951678566,
    0.0001537966292958408,
    0.0000154353476192179,
    -0.0000065434113851906,
    0.0000003728082407879,
    0.0000002072078388189,
    -0.0000000658173336470,
    0.0000000074926746354,
    0.0000000011101336884,
    -0.0000000007265140553,
    0.0000000001782723560,
    -0.0000000000217346352,
    -0.0000000000020302035,
    0.0000000000019311827,
    -0.0000000000006044953,
    0.0000000000001209450,
    -0.0000000000000125109,
    -0.0000000000000019917,
    0.0000000000000015154,
    -0.0000000000000004977,
    0.0000000000000001155,
    -0.0000000000000000186,
];

static BIP1_CS: ChebSeries = ChebSeries {
    c: &BIP1_DATA,
    order: 23,
    a: -1.0,
    b: 1.0,
    order_sp: 13,
};

static BIP2_DATA: [f64; 29] = [
    -0.13269705443526630495,
    -0.00568443626045977481,
    -0.00015643601119611610,
    -0.00001136737203679562,
    -0.00000143464350991284,
    -0.00000018098531185164,
    0.00000000926177343611,
    0.00000001710005490721,
    0.00000000476698163504,
    -0.00000000035195022023,
    -0.00000000058890614316,
    -0.00000000006678499608,
    0.00000000006395565102,
    0.00000000001554529427,
    -0.00000000000792397000,
    -0.00000000000258326243,
    0.00000000000121655048,
    0.00000000000038707207,
    -0.00000000000022487045,
    -0.00000000000004953477,
    0.00000000000004563782,
    0.00000000000000332998,
    -0.00000000000000921750,
    0.00000000000000094157,
    0.00000000000000167154,
    -0.00000000000000055134,
    -0.00000000000000022369,
    0.00000000000000017487,
    0.00000000000000000207,
];

static BIP2_CS: ChebSeries = ChebSeries {
    c: &BIP2_DATA,
    order: 28,
    a: -1.0,
    b: 1.0,
    order_sp: 14,
};

static AN20_DATA: [f64; 16] = [
    0.0126732217145738027,
    -0.0005212847072615621,
    -0.0000052672111140370,
    -0.0000001628202185026,
    -0.0000000090991442687,
    -0.0000000007438647126,
    -0.0000000000795494752,
    -0.0000000000104050944,
    -0.0000000000015932426,
    -0.0000000000002770648,
    -0.0000000000000535343,
    -0.0000000000000113062,
    -0.0000000000000025772,
    -0.0000000000000006278,
    -0.0000000000000001621,
    -0.0000000000000000441,
];

static AN20_CS: ChebSeries = ChebSeries {
    c: &AN20_DATA,
    order: 15,
    a: -1.0,
    b: 1.0,
    order_sp: 8,
};

static AN21_DATA: [f64; 24] = [
    0.0198313155263169394,
    -0.0029376249067087533,
    -0.0001136260695958196,
    -0.0000100554451087156,
    -0.0000013048787116563,
    -0.0000002123881993151,
    -0.0000000402270833384,
    -0.0000000084996745953,
    -0.0000000019514839426,
    -0.0000000004783865344,
    -0.0000000001236733992,
    -0.0000000000334137486,
    -0.0000000000093702824,
    -0.0000000000027130128,
    -0.0000000000008075954,
    -0.0000000000002463214,
    -0.0000000000000767656,
    -0.0000000000000243883,
    -0.0000000000000078831,
    -0.0000000000000025882,
    -0.0000000000000008619,
    -0.0000000000000002908,
    -0.0000000000000000993,
    -0.0000000000000000343,
];

static AN21_CS: ChebSeries = ChebSeries {
    c: &AN21_DATA,
    order: 23,
    a: -1.0,
    b: 1.0,
    order_sp: 12,
};

static AN22_DATA: [f64; 33] = [
    0.0537418629629794329,
    -0.0126661435859883193,
    -0.0011924334106593007,
    -0.0002032327627275655,
    -0.0000446468963075164,
    -0.0000113359036053123,
    -0.0000031641352378546,
    -0.0000009446708886149,
    -0.0000002966562236472,
    -0.0000000969118892024,
    -0.0000000326822538653,
    -0.0000000113144618964,
    -0.0000000040042691002,
    -0.0000000014440333684,
    -0.0000000005292853746,
    -0.0000000001967763374,
    -0.0000000000740800096,
    -0.0000000000282016314,
    -0.0000000000108440066,
    -0.0000000000042074801,
    -0.0000000000016459150,
    -0.0000000000006486827,
    -0.0000000000002574095,
    -0.0000000000001027889,
    -0.0000000000000412846,
    -0.0000000000000166711,
    -0.0000000000000067657,
    -0.0000000000000027585,
    -0.0000000000000011296,
    -0.0000000000000004645,
    -0.0000000000000001917,
    -0.0000000000000000794,
    -0.0000000000000000330,
];

static AN22_CS: ChebSeries = ChebSeries {
    c: &AN22_DATA,
    order: 32,
    a: -1.0,
    b: 1.0,
    order_sp: 18,
};

static APH0_DATA: [f64; 15] = [
    -0.0855849241130933257,
    0.0011214378867065261,
    0.0000042721029353664,
    0.0000000817607381483,
    0.0000000033907645000,
    0.0000000002253264423,
    0.0000000000206284209,
    0.0000000000023858763,
    0.0000000000003301618,
    0.0000000000000527010,
    0.0000000000000094555,
    0.0000000000000018709,
    0.0000000000000004024,
    0.0000000000000000930,
    0.0000000000000000229,
];

static APH0_CS: ChebSeries = ChebSeries {
    c: &APH0_DATA,
    order: 14,
    a: -1.0,
    b: 1.0,
    order_sp: 7,
};

static APH1_DATA: [f64; 22] = [
    -0.1024172908077571694,
    0.0071697275146591248,
    0.0001209959363122329,
    0.0000073361512841220,
    0.0000007535382954272,
    0.0000001041478171741,
    0.0000000174358728519,
    0.0000000033399795033,
    0.0000000007073075174,
    0.0000000001619187515,
    0.0000000000394539982,
    0.0000000000101192282,
    0.0000000000027092778,
    0.0000000000007523806,
    0.0000000000002156369,
    0.0000000000000635283,
    0.0000000000000191757,
    0.0000000000000059143,
    0.0000000000000018597,
    0.0000000000000005950,
    0.0000000000000001934,
    0.0000000000000000638,
];

static APH1_CS: ChebSeries = ChebSeries {
    c: &APH1_DATA,
    order: 21,
    a: -1.0,
    b: 1.0,
    order_sp: 10,
};

static APH2_DATA: [f64; 32] = [
    -0.2057088719781465107,
    0.0422196961357771922,
    0.0020482560511207275,
    0.000260780073