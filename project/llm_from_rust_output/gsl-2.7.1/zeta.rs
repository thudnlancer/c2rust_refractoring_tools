use std::f64::consts::{PI, LN_2};
use std::f64::{NAN, INFINITY};

#[derive(Debug, Clone, Copy)]
pub struct SfResult {
    pub val: f64,
    pub err: f64,
}

impl Default for SfResult {
    fn default() -> Self {
        Self { val: 0.0, err: 0.0 }
    }
}

#[derive(Debug, Clone, Copy)]
struct ChebSeries {
    c: &'static [f64],
    order: i32,
    a: f64,
    b: f64,
    order_sp: i32,
}

const ZETA_XLT1_DATA: [f64; 14] = [
    1.4801867715693156, 0.25012062539889426, 0.009911375021353608, -0.0001208475965667641,
    -4.758586636766256e-6, 2.2229946694466392e-7, -2.2237496498030257e-9, -1.0173226513229028e-10,
    4.375664345042456e-12, -6.222963259310055e-14, -6.611620100327221e-16, 4.947727953337391e-17,
    -1.042981909345619e-18, 6.992521616658002e-21,
];

const ZETA_XGT1_DATA: [f64; 30] = [
    19.391851572672412, 9.152532969251076, 0.242789765886738, -0.13390006882620273, 
    0.05778270640650286, -0.01876259837540023, 0.0039403014258320355, -5.81508273158128e-5,
    -0.00037561489072148207, 0.00018925305481092143, -5.4903219965551035e-5, 8.708648400893904e-6,
    6.460947792481189e-7, -9.674977391505909e-7, 3.658540076676726e-7, -8.459251642727516e-8,
    9.995678614449794e-9, 1.4260036420951118e-9, -1.176196882338288e-9, 3.7114575899785205e-10,
    -7.475685519421096e-11, 7.85369342091837e-12, 9.982718225968554e-13, -7.527668703019222e-13,
    2.195502639396428e-13, -4.193485985283465e-14, 4.634114963593355e-15, 2.374248850904834e-16,
    -2.7276516388124786e-16, 7.847357013463604e-17,
];

const ZETAM1_INTER_DATA: [f64; 24] = [
    -21.750943565308848, -5.630368776981218, 0.05280413586842294, -0.01563818091796708,
    0.004082184743723559, -0.0010264867349474874, 0.0002604698804098869, -6.761758472099689e-5,
    1.7928447258783352e-5, -4.832386513185562e-6, 1.3191378896499929e-6, -3.6376050065632997e-7,
    1.0114684751319475e-7, -2.832152251418065e-8, 7.977337102520214e-9, -2.258501685539569e-9,
    6.422693929501643e-10, -1.8336386184612728e-10, 5.253097638952832e-11, -1.5095868704258982e-11,
    4.3499754551604924e-12, -1.2559778274819042e-12, 3.6128074007222265e-13, -9.664372392057452e-14,
];

const HZETA_C: [f64; 15] = [
    1.0, 0.08333333333333333, -0.001388888888888889, 3.306878306878307e-5,
    -8.267195767195767e-7, 2.08767569878681e-8, -5.284190138687493e-10, 1.3382536530684679e-11,
    -3.389680296322583e-13, 8.586062056277845e-15, -2.1748686985580619e-16, 5.50900282836023e-18,
    -1.3954464685812523e-19, 3.5347070396294675e-21, -8.953517427037547e-23,
];

const ZETAM1_POS_INT_TABLE: [f64; 101] = [
    -1.5, 0.0, 0.6449340668482264, 0.20205690315959428, 0.08232323371113819,
    0.036927755143369926, 0.01734306198444914, 0.008349277381922827, 0.0040773561979443395,
    0.0020083928260822144, 0.0009945751278180853, 0.0004941886041194646, 0.0002460865533080483,
    0.00012271334757848915, 6.124813505870483e-5, 3.0588236307020206e-5, 1.5282259408324365e-5,
    7.637197637899763e-6, 3.81729326499984e-6, 1.908212716553939e-6, 9.539620338727961e-7,
    4.769329867878065e-7, 2.38450502727733e-7, 1.1921992596531107e-7, 5.960818905125948e-8,
    2.980350351465228e-8, 1.4901554828365041e-8, 7.45071178983543e-9, 3.725334024788457e-9,
    1.862659723513049e-9, 9.313274324196682e-10, 4.656629065033784e-10, 2.3283118336765055e-10,
    1.164155017270052e-10, 5.820772087902701e-11, 2.9103850444970997e-11, 1.4551921891041984e-11,
    7.275959835057481e-12, 3.637979547378651e-12, 1.818989650307066e-12, 9.09494784026389e-13,
    4.547473783042154e-13, 2.2737368458246525e-13, 1.1368684076802278e-13, 5.684341987627586e-14,
    2.842170976889302e-14, 1.4210854828031607e-14, 7.105427395210853e-15, 3.5527136913371137e-15,
    1.7763568435791203e-15, 8.881784210930816e-16, 4.4408921031438134e-16, 2.220446050798042e-16,
    1.1102230251410661e-16, 5.551115124845481e-17, 2.775557562136124e-17, 1.3877787809725233e-17,
    6.938893904544154e-18, 3.4694469521659226e-18, 1.7347234760475766e-18, 8.673617380119934e-19,
    4.3368086900206505e-19, 2.1684043449972198e-19, 1.0842021724942414e-19, 5.421010862456645e-20,
    2.710505431223469e-20, 1.3552527156101165e-20, 6.776263578045189e-21, 3.388131789020797e-21,
    1.6940658945097992e-21, 8.470329472546998e-22, 4.2351647362728333e-22, 2.1175823681361947e-22,
    1.0587911840680234e-22, 5.2939559203398704e-23, 2.646977960169853e-23, 1.323488980084899e-23,
    6.617444900424404e-24, 3.3087224502121716e-24, 1.6543612251060756e-24, 8.271806125530344e-25,
    4.135903062765161e-25, 2.0679515313825767e-25, 1.0339757656912871e-25, 5.169878828456431e-26,
    2.5849394142282143e-26, 1.2924697071141067e-26, 6.462348535570532e-27, 3.2311742677852654e-27,
    1.6155871338926325e-27, 8.077935669463162e-28, 4.038967834731581e-28, 2.0194839173657903e-28,
    1.0097419586828952e-28, 5.048709793414476e-29, 2.5243548967072378e-29, 1.2621774483536189e-29,
    6.310887241768095e-30, 3.1554436208840472e-30, 1.5777218104420236e-30, 7.888609052210118e-31,
];

const ZETA_NEG_INT_TABLE: [f64; 50] = [
    -0.08333333333333333, 0.008333333333333333, -0.003968253968253968, 0.004166666666666667,
    -0.007575757575757576, 0.021092796092796093, -0.08333333333333333, 0.44325980392156863,
    -3.0539543302701197, 26.45621212121212, -281.46014492753623, 3607.5105463980464,
    -54827.583333333336, 974936.8238505747, -20052695.796688076, 472384867.7216299,
    -1263572479.5916667, 380879311252.4537, -1.2850850499305083e13, 4.824144835485017e14,
    -2.0040310656516253e16, 9.167743603195331e17, -4.59798883436565e19, 2.5180471921451096e21,
    -1.5001733492153929e23, 9.689957887463594e24, -6.764588237929282e26, 5.089065946866229e28,
    -4.114728879255798e30, 3.5666582095375556e32, -3.3066089876577576e34, 3.2715634236478716e36,
    -3.4473782558278054e38, 3.861427983270526e40, -4.589297443245433e42, 5.777538634277043e44,
    -7.691985875950714e46, 1.0813635449971655e49, -1.6029364522008965e51, 2.5019479041560463e53,
    -4.106705233581021e55, 7.079877440849458e57, -1.2804546887939509e60, 2.4267340392333524e62,
    -4.814321887404577e64, 9.987557417572753e66, -2.1645634868435186e69, 4.896232703962055e71,
    -1.154902392396352e74, 2.8382249570693707e76,
];

const ETA_POS_INT_TABLE: [f64; 101] = [
    0.5, 0.6931471805599453, 0.8224670334241132, 0.9015426773696957, 0.9470328294972459,
    0.9721197704469093, 0.9855510912974351, 0.9925938199228303, 0.9962330018526479, 0.9980942975416053,
    0.9990395075982716, 0.9995171434980608, 0.9997576851438582, 0.9998785427632651, 0.9999391703459797,
    0.9999695512130992, 0.9999847642149061, 0.999992378292041, 0.9999961878696101, 0.9999980935081717,
    0.9999990466115815, 0.9999995232582155, 0.9999997616132308, 0.9999998808013184, 0.9999999403988924,
    0.999999970198857, 0.999999985099232, 0.9999999925495505, 0.9999999962747534, 0.9999999981373694,
    0.9999999990686823, 0.9999999995343403, 0.9999999997671699, 0.99999999988358486, 0.9999999999417924,
    0.9999999999708962, 0.9999999999854481, 0.999999999992724, 0.999999999996362, 0.999999999998181,
    0.9999999999990905, 0.9999999999995453, 0.9999999999997726, 0.9999999999998863, 0.9999999999999432,
    0.9999999999999716, 0.9999999999999858, 0.9999999999999929, 0.9999999999999964, 0.9999999999999982,
    0.9999999999999991, 0.9999999999999996, 0.9999999999999998, 0.9999999999999999, 0.9999999999999999,
    0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999,
    0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999,
    0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999,
    0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999,
    0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999,
    0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999,
    0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999,
    0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999,
    0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999,
    0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 1.0,
];

const ETA_NEG_INT_TABLE: [f64; 50] = [
    0.25, -0.125, 0.25, -1.062